# **ModuÅ‚: Debugowanie PHP (Xdebug, Docker, PhpStorm)**  

## **1. Wprowadzenie do debugowania PHP**  
Debugowanie to proces wykrywania i usuwania bÅ‚Ä™dÃ³w w kodzie. PHP domyÅ›lnie oferuje **`var_dump()`** i `error_log()`, ale zaawansowane narzÄ™dzia jak **Xdebug** pozwalajÄ… na peÅ‚ne Å›ledzenie kodu w czasie rzeczywistym.

---

## **2. Co to jest Xdebug?**  
ğŸ”¹ **Xdebug** to rozszerzenie PHP, ktÃ³re umoÅ¼liwia **debugowanie krok po kroku** i profilowanie kodu.  
ğŸ”¹ GÅ‚Ã³wne funkcje Xdebug:  
- **Breakpoints (punkty przerwaÅ„)** â€“ zatrzymujÄ… wykonanie kodu w okreÅ›lonym miejscu.  
- **Stack Trace** â€“ pokazuje peÅ‚nÄ… Å›cieÅ¼kÄ™ wywoÅ‚aÅ„ funkcji.  
- **Profilowanie** â€“ mierzy wydajnoÅ›Ä‡ kodu PHP.  
- **Remote Debugging** â€“ pozwala debugowaÄ‡ kod dziaÅ‚ajÄ…cy na serwerze zdalnym.  

---

## **3. Konfiguracja Xdebug w Dockerze**  
JeÅ›li uÅ¼ywasz PHP w kontenerze Docker, musisz dodaÄ‡ Xdebug do obrazu PHP.

### **ğŸ”¹ Dockerfile â€“ instalacja Xdebug**  
W `Dockerfile` dla PHP dodaj nastÄ™pujÄ…ce linie:  
```dockerfile
RUN pecl install xdebug && docker-php-ext-enable xdebug
```

### **ğŸ”¹ Tworzenie pliku `xdebug.ini`**  
Aby mieÄ‡ peÅ‚nÄ… kontrolÄ™ nad konfiguracjÄ… Xdebug, zamiast edytowaÄ‡ `php.ini`, moÅ¼na utworzyÄ‡ osobny plik konfiguracyjny `xdebug.ini`.

#### **ğŸ”¹ UtwÃ³rz plik `xdebug.ini` w katalogu `docker/php/` i dodaj:**
```ini
zend_extension=xdebug.so

[xdebug]
xdebug.mode=debug
xdebug.start_with_request=yes
xdebug.client_host=host.docker.internal
xdebug.client_port=9003
xdebug.log_level=0
xdebug.log=/var/log/xdebug.log
```

ğŸ”¹ **Co robiÄ… te ustawienia?**  
- `xdebug.mode=debug` â€“ aktywuje tryb debugowania.  
- `xdebug.start_with_request=yes` â€“ automatycznie rozpoczyna debugowanie dla kaÅ¼dego Å¼Ä…dania.  
- `xdebug.client_host=host.docker.internal` â€“ umoÅ¼liwia poÅ‚Ä…czenie miÄ™dzy kontenerem a PhpStorm.  
- `xdebug.client_port=9003` â€“ domyÅ›lny port dla Xdebug.  
- `xdebug.log_level=0` â€“ wyÅ‚Ä…cza logowanie.  
- `xdebug.log=/var/log/xdebug.log` â€“ zapisuje logi Xdebug w kontenerze (opcjonalne).  

### **ğŸ”¹ Konfiguracja `docker-compose.yml`**  
Aby Xdebug dziaÅ‚aÅ‚ prawidÅ‚owo w Å›rodowisku **Docker Compose**, dodaj do `docker-compose.yml`:

```yaml
version: '3.8'
services:
  php:
     build:
        context: ../docker
        dockerfile: php/Dockerfile
     container_name: php-container
     volumes:
        - ../project:/var/www/html
        - ./php/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini  # PoÅ‚Ä…czenie pliku xdebug.ini
     networks:
        - app_network        
     environment:
        PHP_IDE_CONFIG: "serverName=php-docker"
        XDEBUG_MODE: "debug"
        XDEBUG_CONFIG: "client_host=host.docker.internal client_port=9003 start_with_request=yes"
     ports:
        - "9003:9003"
```

ğŸ”¹ **Co robi to ustawienie?**  
```yaml
- ./php/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini
```
- **Pierwsza czÄ™Å›Ä‡** (`./php/xdebug.ini`) â€“ wskazuje lokalny plik konfiguracji Xdebug.  
- **Druga czÄ™Å›Ä‡** (`/usr/local/etc/php/conf.d/xdebug.ini`) â€“ wskazuje, gdzie plik ma byÄ‡ umieszczony w kontenerze.  
- DziÄ™ki temu kaÅ¼da zmiana w `xdebug.ini` jest automatycznie stosowana przy ponownym uruchomieniu kontenera.

### **ğŸ”¹ Sprawdzenie Xdebug w kontenerze**  
Po uruchomieniu kontenerÃ³w sprawdÅº, czy Xdebug dziaÅ‚a:  
```sh
docker exec -it php-container php -m | grep xdebug
```

JeÅ›li Xdebug jest poprawnie wczytany, zobaczysz:  
```
xdebug
```

---

## **4. Konfiguracja Xdebug w PhpStorm**  

### **ğŸ“Œ Ustawienia Xdebug w PhpStorm**  
1. **OtwÃ³rz PhpStorm** â†’ **Settings** â†’ **PHP** â†’ **Debug**.  
2. W sekcji **Xdebug** ustaw:  
   - Port debugowania: **9003**  
   - Opcja `Break at first line in PHP scripts` **(opcjonalnie)**  
3. **Kliknij "Start Listening for PHP Debug Connections"** (ikona telefonu w pasku narzÄ™dzi).  

### **ğŸ“Œ Konfiguracja interpretera PHP (dla Docker Compose)**  
1. **Settings** â†’ **PHP** â†’ **CLI Interpreter**.  
2. **Dodaj nowy interpreter** â†’ wybierz **Docker Compose** jako Å›rodowisko.  
3. **Wybierz usÅ‚ugÄ™ PHP z `docker-compose.yml`**, np. `php`.  
4. **Ustaw Å›cieÅ¼kÄ™ do PHP w kontenerze**, np. `/usr/local/bin/php`.  

### **ğŸ“Œ Ustawienie `serverName=php-docker` w PhpStorm**  
1. **PhpStorm â†’ Settings â†’ PHP â†’ Servers**.  
2. **Dodaj nowy serwer**:  
   - **Name**: `php-docker` (**musi byÄ‡ identyczne z `PHP_IDE_CONFIG="serverName=php-docker"`**)  
   - **Host**: `localhost` lub `host.docker.internal`  
   - **Port**: `80` (dla Apache) lub `9003` (dla Xdebug)  
   - **Debugger**: Xdebug  
3. **Dodaj mapowanie katalogÃ³w**:  
   - **Project files (lokalne)**: `/home/user/project`  
   - **Absolute path on the server (w kontenerze)**: `/var/www/html`  

Teraz PhpStorm bÄ™dzie wiedziaÅ‚, Å¼e **`php-docker` = TwÃ³j kontener PHP** i debugger bÄ™dzie dziaÅ‚aÅ‚ poprawnie.

---

## **5. Testowanie debugowania w PHP**  
Dodaj nastÄ™pujÄ…cy skrypt `test.php`:

```php
<?php
xdebug_info(); // Sprawdzenie konfiguracji

function add($a, $b) {
    return $a + $b;
}

$result = add(5, 10);
var_dump($result); // Zatrzymaj siÄ™ tutaj w debugerze
?>
```

1. Ustaw **breakpoint** na `var_dump($result);`.  
2. Uruchom debugowanie w PhpStorm (`Listen for Debug Connections`).  
3. OtwÃ³rz stronÄ™ w przeglÄ…darce lub uruchom kod w terminalu:  
   ```sh
   docker exec -it php-container php test.php
   ```
4. Debugger powinien zatrzymaÄ‡ siÄ™ na `var_dump($result);`.  

---

## **6. ğŸš€ Podsumowanie**  
ğŸ“Œ **Co nauczyliÅ›my siÄ™ w tej lekcji?**  
âœ” Jak skonfigurowaÄ‡ **Xdebug w Dockerze i Docker Compose**.  
âœ” Jak uÅ¼ywaÄ‡ **PhpStorm do debugowania w kontenerach**.  
âœ” Jak dziaÅ‚a **PHP_IDE_CONFIG i mapowanie serwerÃ³w**.  
âœ” Jak podÅ‚Ä…czyÄ‡ zewnÄ™trzny plik **xdebug.ini w Docker Compose**.  
âœ” Jak ustawiaÄ‡ **breakpointy i analizowaÄ‡ kod krok po kroku**.  

DziÄ™ki tej konfiguracji moÅ¼esz **efektywnie debugowaÄ‡ aplikacje PHP dziaÅ‚ajÄ…ce w kontenerach Docker!** ğŸš€  
